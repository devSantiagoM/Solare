<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Solare - Mi Perfil" />
    <title>Solare | Mi Perfil</title>
    <link rel="stylesheet" href="../css/global.css" />
    <link rel="stylesheet" href="../css/navbar.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link rel="stylesheet" href="../css/perfil.css" />
    <script type="module" src="../js/supabase.js"></script>
    <script src="../js/auth-state.js" defer></script>
    <script src="../js/toast.js" defer></script>
    <script src="../js/navbar.js" defer></script>
    <script src="../js/layout.js" defer></script>
    <script src="../js/perfil.js" defer></script>
  </head>
  <body class="perfil-body">
    <!-- Navbar -->
    <nav class="navbar">
      <div class="navbar-container">
        <!-- Left side: Hamburger + Login (Mobile) -->
        <div class="navbar-left">
          <div class="hamburger-menu">
            <button
              class="hamburger-btn"
              id="hamburgerBtn"
              aria-label="Abrir menú"
            >
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
              <span class="hamburger-line"></span>
            </button>
          </div>
          <a
            href="perfil.html"
            class="icon-link login-icon-mobile"
            title="Mi Cuenta"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
        </div>

        <!-- Logo/Brand -->
        <div class="navbar-brand">
          <a href="index.html" class="brand-link">
            <span class="brand-text">SOLARE</span>
          </a>
        </div>

        <!-- Desktop Navigation Menu -->
        <div class="navbar-menu">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a href="productos.html?cat=mujer" class="nav-link">MUJER</a>
              <div class="dropdown-content">
                <a href="productos.html?cat=mujer#nuevos-llegados"
                  >Nuevos Llegados</a
                >
                <a href="productos.html?cat=mujer#invierno-otono"
                  >Invierno-Otoño</a
                >
                <a href="productos.html?cat=mujer#primavera-verano"
                  >Primavera-Verano</a
                >
                <a href="productos.html?cat=mujer">Ver Todo</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a href="productos.html?cat=hombre" class="nav-link">HOMBRE</a>
              <div class="dropdown-content">
                <a href="productos.html?cat=hombre#nuevos-llegados"
                  >Nuevos Llegados</a
                >
                <a href="productos.html?cat=hombre#invierno-otono"
                  >Invierno-Otoño</a
                >
                <a href="productos.html?cat=hombre#primavera-verano"
                  >Primavera-Verano</a
                >
                <a href="productos.html?cat=hombre">Ver Todo</a>
              </div>
            </li>
            <li class="nav-item dropdown">
              <a href="productos.html" class="nav-link">COLECCIONES</a>
              <div class="dropdown-content">
                <a href="productos.html#nuevos-llegados">Nuevos Llegados</a>
                <a href="productos.html#invierno-otono">Invierno-Otoño</a>
                <a href="productos.html#primavera-verano">Primavera-Verano</a>
                <a href="productos.html#otros">Otros</a>
              </div>
            </li>
            <li class="nav-item">
              <a href="productos.html" class="nav-link">PRODUCTOS</a>
            </li>
            <li class="nav-item">
              <a href="novedades.html" class="nav-link">NOVEDADES</a>
            </li>
            <li class="nav-item">
              <a href="faq.html" class="nav-link">FAQ</a>
            </li>
            <li class="nav-item">
              <a href="nosotros.html" class="nav-link">NOSOTROS</a>
            </li>
            <li class="nav-item">
              <a href="contacto.html" class="nav-link">CONTACTO</a>
            </li>
          </ul>
        </div>

        <!-- Right side icons -->
        <div class="navbar-icons">
          <a href="favoritos.html" class="icon-link fav-icon" title="Favoritos">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M12 21s-6.5-4.4-9-7.9C1.5 10 2.4 6.5 5.1 5.1c2-1.1 4.5-.3 5.9 1.3 1.4-1.6 3.9-2.4 5.9-1.3 2.7 1.4 3.6 4.9 2.1 8-2.5 3.5-9 7.9-9 7.9z"
              ></path>
            </svg>
            <span class="fav-count" id="favCount">0</span>
          </a>
          <a href="carrito.html" class="icon-link cart-icon" title="Carrito">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"
              ></path>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <path d="M16 10a4 4 0 0 1-8 0"></path>
            </svg>
            <span class="cart-count" id="cartCount">0</span>
          </a>
          <a
            href="perfil.html"
            class="icon-link account-icon-desktop"
            title="Mi Cuenta"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </a>
        </div>
      </div>

      <!-- Mobile Menu Overlay -->
      <div class="mobile-menu-overlay" id="mobileMenuOverlay">
        <div class="mobile-menu-content">
          <div class="mobile-menu-header">
            <span class="mobile-brand">SOLARE</span>
            <button class="close-btn" id="closeBtn">
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>

          <nav class="mobile-nav">
            <div class="mobile-nav-item">
              <a href="productos.html?cat=mujer" class="mobile-nav-link main-link"
                >MUJER</a
              >
              <div class="mobile-submenu">
                <a
                  href="productos.html?cat=mujer#nuevos-llegados"
                  class="mobile-submenu-link"
                  >Nuevos Llegados</a
                >
                <a
                  href="productos.html?cat=mujer#invierno-otono"
                  class="mobile-submenu-link"
                  >Invierno-Otoño</a
                >
                <a
                  href="productos.html?cat=mujer#primavera-verano"
                  class="mobile-submenu-link"
                  >Primavera-Verano</a
                >
                <a href="productos.html?cat=mujer" class="mobile-submenu-link"
                  >Ver Todo</a
                >
              </div>
            </div>

            <div class="mobile-nav-item">
              <a href="productos.html?cat=hombre" class="mobile-nav-link main-link"
                >HOMBRE</a
              >
              <div class="mobile-submenu">
                <a
                  href="productos.html?cat=hombre#nuevos-llegados"
                  class="mobile-submenu-link"
                  >Nuevos Llegados</a
                >
                <a
                  href="productos.html?cat=hombre#invierno-otono"
                  class="mobile-submenu-link"
                  >Invierno-Otoño</a
                >
                <a
                  href="productos.html?cat=hombre#primavera-verano"
                  class="mobile-submenu-link"
                  >Primavera-Verano</a
                >
                <a href="productos.html?cat=hombre" class="mobile-submenu-link"
                  >Ver Todo</a
                >
              </div>
            </div>

            <div class="mobile-nav-item">
              <a href="productos.html" class="mobile-nav-link main-link"
                >COLECCIONES</a
              >
              <div class="mobile-submenu">
                <a
                  href="productos.html#nuevos-llegados"
                  class="mobile-submenu-link"
                  >Nuevos Llegados</a
                >
                <a
                  href="productos.html#invierno-otono"
                  class="mobile-submenu-link"
                  >Invierno-Otoño</a
                >
                <a
                  href="productos.html#primavera-verano"
                  class="mobile-submenu-link"
                  >Primavera-Verano</a
                >
                <a href="productos.html#otros" class="mobile-submenu-link"
                  >Otros</a
                >
              </div>
            </div>

            <div class="mobile-nav-item">
              <a href="productos.html" class="mobile-nav-link">PRODUCTOS</a>
            </div>

            <div class="mobile-nav-item">
              <a href="novedades.html" class="mobile-nav-link">NOVEDADES</a>
            </div>

            <div class="mobile-nav-item">
              <a href="faq.html" class="mobile-nav-link">FAQ</a>
            </div>

            <div class="mobile-nav-item">
              <a href="nosotros.html" class="mobile-nav-link">NOSOTROS</a>
            </div>

            <div class="mobile-nav-item">
              <a href="contacto.html" class="mobile-nav-link">CONTACTO</a>
            </div>
          </nav>
        </div>
      </div>
    </nav>

    <main id="main-content" tabindex="-1" class="perfil-main">
      <section class="perfil-shell">
        <div class="perfil-layout container">
          <!-- Sidebar -->
          <aside class="perfil-sidebar">
            <div class="perfil-avatar-section">
              <div class="perfil-avatar-container">
                <img
                  id="perfil-avatar"
                  src="https://ui-avatars.com/api/?name=Usuario&background=111&color=fff&size=128"
                  alt="Avatar"
                  class="perfil-avatar"
                />
                <button
                  id="btn-change-avatar"
                  class="perfil-avatar-edit"
                  aria-label="Cambiar avatar"
                  title="Cambiar foto de perfil"
                >
                  <svg
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                    ></path>
                    <path
                      d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                    ></path>
                  </svg>
                </button>
                <input
                  type="file"
                  id="avatar-input"
                  accept="image/*"
                  style="display: none"
                />
              </div>
              <h1 id="perfil-name" class="perfil-name">Cargando...</h1>
              <p id="perfil-email" class="perfil-email">Cargando...</p>
            </div>

            <nav aria-label="Secciones del perfil" class="perfil-nav">
              <div class="perfil-nav-list">
                <button
                  class="perfil-nav-btn perfil-nav-btn-active"
                  data-section="informacion"
                >
                  Información Personal
                </button>
                <button class="perfil-nav-btn" data-section="direcciones">
                  Direcciones
                </button>
                <button class="perfil-nav-btn" data-section="pedidos">
                  Mis Pedidos
                </button>
                <button class="perfil-nav-btn" data-section="configuracion">
                  Configuración
                </button>
              </div>
            </nav>

            <div class="perfil-sidebar-actions">
              <button id="btn-go-home" class="perfil-btn perfil-btn-primary">
                Ir a inicio
              </button>
              <button id="btn-logout" class="perfil-btn perfil-btn-ghost">
                Cerrar sesión
              </button>
            </div>
          </aside>

          <!-- Contenido principal -->
          <div class="perfil-content">
            <!-- Información Personal -->
            <section
              data-perfil-section="informacion"
              class="perfil-section perfil-section-active"
            >
              <header class="perfil-section-header">
                <p class="perfil-section-kicker">Datos</p>
                <h2 class="perfil-section-title">Información Personal</h2>
              </header>

              <form id="form-informacion" class="perfil-form">
                <div class="perfil-form-grid">
                  <div class="perfil-form-group">
                    <label for="first-name">Nombre</label>
                    <input
                      type="text"
                      id="first-name"
                      name="first_name"
                      placeholder="Tu nombre"
                      required
                    />
                  </div>

                  <div class="perfil-form-group">
                    <label for="last-name">Apellido</label>
                    <input
                      type="text"
                      id="last-name"
                      name="last_name"
                      placeholder="Tu apellido"
                      required
                    />
                  </div>

                  <div class="perfil-form-group">
                    <label for="email">Email</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      placeholder="tu@email.com"
                      required
                      disabled
                    />
                    <small class="perfil-form-help"
                      >El email no se puede cambiar</small
                    >
                  </div>

                  <div class="perfil-form-group">
                    <label for="phone">Teléfono</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      placeholder="+52 123 456 7890"
                    />
                  </div>

                  <div class="perfil-form-group">
                    <label for="date-of-birth">Fecha de Nacimiento</label>
                    <input
                      type="date"
                      id="date-of-birth"
                      name="date_of_birth"
                    />
                  </div>

                  <div class="perfil-form-group">
                    <label for="gender">Género</label>
                    <select id="gender" name="gender">
                      <option value="">Seleccionar</option>
                      <option value="masculino">Masculino</option>
                      <option value="femenino">Femenino</option>
                      <option value="otro">Otro</option>
                      <option value="prefiero_no_decir">Prefiero no decir</option>
                    </select>
                  </div>
                </div>

                <div class="perfil-form-actions">
                  <button type="submit" class="perfil-btn perfil-btn-primary">
                    Guardar Cambios
                  </button>
                  <button
                    type="button"
                    class="perfil-btn perfil-btn-ghost"
                    id="btn-cancel-informacion"
                  >
                    Cancelar
                  </button>
                </div>
              </form>
            </section>

            <!-- Direcciones -->
            <section
              data-perfil-section="direcciones"
              class="perfil-section"
            >
              <header class="perfil-section-header">
                <p class="perfil-section-kicker">Envío</p>
                <h2 class="perfil-section-title">Mis Direcciones</h2>
              </header>

              <div class="perfil-addresses-container">
                <div id="addresses-list" class="perfil-addresses-list">
                  <!-- Las direcciones se cargarán dinámicamente -->
                </div>

                <button
                  id="btn-add-address"
                  class="perfil-btn perfil-btn-primary perfil-btn-inline"
                >
                  + Agregar Dirección
                </button>
              </div>

              <!-- Modal para agregar/editar dirección -->
              <div id="address-modal" class="perfil-modal" hidden>
                <div class="perfil-modal-content">
                  <div class="perfil-modal-header">
                    <h3 id="address-modal-title">Agregar Dirección</h3>
                    <button
                      id="btn-close-address-modal"
                      class="perfil-modal-close"
                      aria-label="Cerrar"
                    >
                      &times;
                    </button>
                  </div>

                  <form id="form-address" class="perfil-form">
                    <input type="hidden" id="address-id" name="id" />

                    <div class="perfil-form-group">
                      <label>
                        <input
                          type="radio"
                          name="type"
                          value="shipping"
                          checked
                        />
                        Dirección de Envío
                      </label>
                      <label>
                        <input type="radio" name="type" value="billing" />
                        Dirección de Facturación
                      </label>
                    </div>

                    <div class="perfil-form-group">
                      <label>
                        <input
                          type="checkbox"
                          name="is_default"
                          id="address-is-default"
                        />
                        Marcar como dirección predeterminada
                      </label>
                    </div>

                    <div class="perfil-form-grid">
                      <div class="perfil-form-group">
                        <label for="address-first-name">Nombre</label>
                        <input
                          type="text"
                          id="address-first-name"
                          name="first_name"
                          required
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-last-name">Apellido</label>
                        <input
                          type="text"
                          id="address-last-name"
                          name="last_name"
                          required
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-company">Empresa (opcional)</label>
                        <input
                          type="text"
                          id="address-company"
                          name="company"
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-phone">Teléfono</label>
                        <input
                          type="tel"
                          id="address-phone"
                          name="phone"
                        />
                      </div>

                      <div class="perfil-form-group perfil-form-group-full">
                        <label for="address-line-1">Dirección Línea 1</label>
                        <input
                          type="text"
                          id="address-line-1"
                          name="address_line_1"
                          required
                        />
                      </div>

                      <div class="perfil-form-group perfil-form-group-full">
                        <label for="address-line-2"
                          >Dirección Línea 2 (opcional)</label
                        >
                        <input
                          type="text"
                          id="address-line-2"
                          name="address_line_2"
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-city">Ciudad</label>
                        <input
                          type="text"
                          id="address-city"
                          name="city"
                          required
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-state">Estado</label>
                        <input
                          type="text"
                          id="address-state"
                          name="state"
                          required
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-postal-code">Código Postal</label>
                        <input
                          type="text"
                          id="address-postal-code"
                          name="postal_code"
                          required
                        />
                      </div>

                      <div class="perfil-form-group">
                        <label for="address-country">País</label>
                        <input
                          type="text"
                          id="address-country"
                          name="country"
                          value="México"
                          required
                        />
                      </div>
                    </div>

                    <div class="perfil-form-actions">
                      <button
                        type="submit"
                        class="perfil-btn perfil-btn-primary"
                      >
                        Guardar Dirección
                      </button>
                      <button
                        type="button"
                        class="perfil-btn perfil-btn-ghost"
                        id="btn-cancel-address"
                      >
                        Cancelar
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </section>

            <!-- Pedidos -->
            <section data-perfil-section="pedidos" class="perfil-section">
              <header class="perfil-section-header">
                <p class="perfil-section-kicker">Historial</p>
                <h2 class="perfil-section-title">Mis Pedidos</h2>
              </header>

              <div id="orders-list" class="perfil-orders-list">
                <!-- Los pedidos se cargarán dinámicamente -->
              </div>

              <div id="orders-empty" class="perfil-orders-empty" hidden>
                <p>No tienes pedidos aún.</p>
                <a href="productos.html" class="perfil-btn perfil-btn-primary perfil-btn-inline"
                  >Explorar Productos</a
                >
              </div>
            </section>

            <!-- Configuración -->
            <section
              data-perfil-section="configuracion"
              class="perfil-section"
            >
              <header class="perfil-section-header">
                <p class="perfil-section-kicker">Ajustes</p>
                <h2 class="perfil-section-title">Configuración</h2>
              </header>

              <div class="perfil-settings">
                <!-- Cambiar Contraseña -->
                <div class="perfil-setting-card">
                  <h3 class="perfil-setting-title">Cambiar Contraseña</h3>
                  <form id="form-password" class="perfil-form">
                    <div class="perfil-form-group">
                      <label for="current-password">Contraseña Actual</label>
                      <input
                        type="password"
                        id="current-password"
                        name="current_password"
                        required
                      />
                    </div>

                    <div class="perfil-form-group">
                      <label for="new-password">Nueva Contraseña</label>
                      <input
                        type="password"
                        id="new-password"
                        name="new_password"
                        required
                        minlength="8"
                      />
                    </div>

                    <div class="perfil-form-group">
                      <label for="confirm-password">Confirmar Nueva Contraseña</label>
                      <input
                        type="password"
                        id="confirm-password"
                        name="confirm_password"
                        required
                        minlength="8"
                      />
                    </div>

                    <div class="perfil-form-actions">
                      <button
                        type="submit"
                        class="perfil-btn perfil-btn-primary"
                      >
                        Cambiar Contraseña
                      </button>
                    </div>
                  </form>
                </div>

                <!-- Notificaciones -->
                <div class="perfil-setting-card">
                  <h3 class="perfil-setting-title">Notificaciones</h3>
                  <form id="form-notifications" class="perfil-form">
                    <div class="perfil-form-group">
                      <label class="perfil-checkbox-label">
                        <input
                          type="checkbox"
                          id="email-notifications"
                          name="email_notifications"
                        />
                        <span class="perfil-checkmark"></span>
                        Recibir notificaciones por email
                      </label>
                    </div>

                    <div class="perfil-form-group">
                      <label class="perfil-checkbox-label">
                        <input
                          type="checkbox"
                          id="sms-notifications"
                          name="sms_notifications"
                        />
                        <span class="perfil-checkmark"></span>
                        Recibir notificaciones por SMS
                      </label>
                    </div>

                    <div class="perfil-form-actions">
                      <button
                        type="submit"
                        class="perfil-btn perfil-btn-primary"
                      >
                        Guardar Preferencias
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </section>
          </div>
        </div>
      </section>
    </main>

    <footer id="footer"></footer>
  </body>
</html>

